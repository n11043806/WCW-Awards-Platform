<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - WCW Awards</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #fafafa;
      color: #333;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 220px;
      height: 100vh;
      background-color: #d62d83;
      padding: 20px;
      color: white;
      display: flex;
      flex-direction: column;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 22px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 4px;
      margin-bottom: 10px;
      transition: background-color 0.2s;
    }
    .sidebar a:hover, .sidebar a.active {
      background-color: #b8235a;
    }
    .main-content {
      margin-left: 220px;
      padding: 30px;
    }
    header {
      background-color: #d62d83;
      color: white;
      padding: 20px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logout-btn {
      background-color: white;
      color: #d62d83;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .logout-btn:hover { background-color: #ffe6ee; }
    .cards-row, .tab-row {
      display: flex;
      gap: 20px;
      margin: 30px 0;
    }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      flex: 1;
    }
    .card:hover {
      box-shadow: 0 0 10px rgba(245, 1, 147, 0.2);
    }
    .card-title {
      font-weight: bold;
      color: #d62d83;
      margin-bottom: 10px;
    }
    .chart-canvas {
      width: 100%;
      height: 200px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #fafafa;
      color: #d62d83;
    }
    footer {
      text-align: center;
      color: #888;
      margin-top: 40px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>WCW Admin</h2>
    <a href="#" class="active">Dashboard</a>
    <a href="adminentriestab.html">Entries</a> 
    <a href="adminusertab.html">Users</a>
    <a href="adminjudgetab.html">Judging</a>
    <a href="#">Logout</a>
  </div>
  <div class="main-content">
    <header>
      <h1>Welcome, <span id="adminName">Trial Account</span></h1>
      <button class="logout-btn" onclick="logout()">Log Out</button>
    </header>
    <div class="cards-row">
      <div class="card" onclick="window.location.href='adminrounddetails.html'" style="cursor:pointer">
        <div class="card-title">WCW25</div>
        <p>Open</p>
      </div>
      <div class="card" onclick="window.location.href='adminjudginground.html'" style="cursor:pointer">
        <div class="card-title">Judging open period</div>
        <p>Open</p>
      </div>
      <div class="card"><div class="card-title">Finalist Videos</div><p>Open</p></div>
      <div class="card"><div class="card-title">Award Status</div><p>Open</p></div>
    </div>
    <div class="cards-row">
      <div class="card">
        <div class="card-title">Completion</div>
        <canvas id="completionChart" class="chart-canvas"></canvas>
        <p><strong style="color:#d62d83" id="submittedCount">0</strong> Submitted &nbsp;
           <strong id="inProgressCount">0</strong> In progress</p>
      </div>
      <div class="card">
        <div class="card-title">Daily Volume</div>
        <canvas id="dailyChart" class="chart-canvas"></canvas>
        <small><span style="color:#d62d83">●</span> Submitted &nbsp;
               <span style="color:#e57373">●</span> Created</small>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Entries by Category</div>
      <table>
        <tr><th>Category</th><th>In Progress</th><th>Submitted</th></tr>
        <tr><td>Changemaker</td><td>3</td><td>23</td></tr>
        <tr><td>Leader of the Year</td><td>7</td><td>22</td></tr>
        <tr><td>Global Impact</td><td>7</td><td>17</td></tr>
        <tr><td>Entrepreneur of the Year</td><td>0</td><td>16</td></tr>
        <tr><td>Rural and Regional Impact</td><td>5</td><td>15</td></tr>
      </table>
    </div>
    <footer>
      &copy; 2025 WCW Awards Platform. All rights reserved.
    </footer>
  </div>

  <!-- Firebase + Charts -->
  <script src="/__/firebase/12.0.0/firebase-app-compat.js"></script>
  <script src="/__/firebase/12.0.0/firebase-auth-compat.js"></script>
  <script src="/__/firebase/12.0.0/firebase-firestore-compat.js"></script>
  <script src="/__/firebase/init.js?useEmulator=true"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Dashboard JS -->
  <script>
    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "signin.html";
      });
    }

    firebase.auth().onAuthStateChanged(user => {
      if (!user) return window.location.href = "signin.html";
      const uid = user.uid;
      firebase.firestore().collection("users").doc(uid).get().then(doc => {
        const name = doc.exists && doc.data().fullName ? doc.data().fullName : "Trial Account";
        document.getElementById("adminName").textContent = name;
      });
      loadDashboardCharts();
    });

    function loadDashboardCharts() {
      const db = firebase.firestore();
      const entriesRef = db.collection("entries");
      let submitted = 0, inProgress = 0;
      const createdCounts = {}, submittedCounts = {};

      entriesRef.get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data(), status = data.status;
          const createdAt = data.createdAt?.toDate?.(), submittedAt = data.submittedAt?.toDate?.();
          if (status === "submitted") {
            submitted++;
            if (submittedAt) {
              const date = submittedAt.toISOString().split("T")[0];
              submittedCounts[date] = (submittedCounts[date] || 0) + 1;
            }
          } else {
            inProgress++;
          }
          if (createdAt) {
            const date = createdAt.toISOString().split("T")[0];
            createdCounts[date] = (createdCounts[date] || 0) + 1;
          }
        });

        document.getElementById("submittedCount").textContent = submitted;
        document.getElementById("inProgressCount").textContent = inProgress;

        drawPieChart(submitted, inProgress);
        drawLineChart(createdCounts, submittedCounts);
      });
    }

    function drawPieChart(submitted, inProgress) {
      new Chart(document.getElementById("completionChart"), {
        type: "pie",
        data: {
          labels: ["Submitted", "In Progress"],
          datasets: [{ data: [submitted, inProgress], backgroundColor: ["#d62d83", "#e0e0e0"] }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
    }

    function drawLineChart(createdCounts, submittedCounts) {
      const allDates = new Set([...Object.keys(createdCounts), ...Object.keys(submittedCounts)]);
      const sortedDates = [...allDates].sort();
      const createdData = sortedDates.map(date => createdCounts[date] || 0);
      const submittedData = sortedDates.map(date => submittedCounts[date] || 0);

      new Chart(document.getElementById("dailyChart"), {
        type: "line",
        data: {
          labels: sortedDates,
          datasets: [
            { label: "Created", data: createdData, borderColor: "#e57373", fill: false },
            { label: "Submitted", data: submittedData, borderColor: "#d62d83", fill: false }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }
  </script>
</body>
</html>
